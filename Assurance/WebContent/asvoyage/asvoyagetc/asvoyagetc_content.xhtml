<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf">
    <ui:composition>
        <div class="col-md-12 col-xs-12 col-sm-12 col-lg-12">
            <fieldset> 
                <legend class="text-center text-uppercase"> <p:outputLabel value="#{msg['demande.gestion']}"></p:outputLabel></legend>
            </fieldset>
            <div id="liste" class="row">
                <div class="col-lg-4 col-md-4 col-xs-4 col-sm-4 well-lg" id="espace_message">
                    <div class="panel">
                        <div class="panel-heading bg-primary">

                            <p:panel toggleable="true" rendered="false" collapsed="true" header="#{msg['recherche.titre']}">
                                <h:form  class="form-horizontal" id="recherche">
                                    <div class="row">
                                        <div class="form-group">
                                            <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                                <h:outputLabel for="pays"  value="#{msg['titre.pays']}" class="pull-left text-left"/>    
                                            </div>
                                            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                                                <h:selectOneMenu id="pays"   class="form-control"  converter="entityConverter" value="#{espaceCompagnieBean.paysSelected}" >                                          
                                                    <f:selectItem itemLabel="#{msg['titre.tousLesPays']}" itemDisabled="false" />
                                                    <f:selectItems var="pays" value="#{espaceCompagnieBean.listpays}" itemLabel="#{pays.designationPays}" itemValue="#{pays}" />            
                                                </h:selectOneMenu>
                                            </div>
                                        </div> 
                                        <div class="form-group">
                                            <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                                <h:outputLabel for="compagnie"  value="#{msg['titre.compagnie']}" class="pull-left text-left"/>                              
                                            </div>
                                            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                                                <h:selectOneMenu id="compagnie" value="#{espaceCompagnieBean.compagnieSelected}"  converter="entityConverter"  class="form-control" >                                          
                                                    <f:selectItem itemLabel="#{msg['titre.tousLesCompagnies']}" itemDisabled="false" />
                                                    <f:selectItems value="#{espaceCompagnieBean.listCompagnie}" var="compagnie" itemLabel="#{compagnie.abbreviation}" itemValue="#{compagnie}" />            
                                                </h:selectOneMenu>
                                            </div> 
                                        </div>
                                        <div class="form-group">
                                            <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                                <h:outputLabel for="courtier"  value="#{msg['titre.courtier']}"/>   
                                            </div>
                                            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                                                <h:selectOneMenu id="courtier"  converter="entityConverter" value="#{espaceCompagnieBean.courtierSelected}" class="form-control" >                                          
                                                    <f:selectItem itemLabel="#{msg['titre.courtier']}" itemDisabled="false" />
                                                    <f:selectItems var="courtier" value="#{espaceCompagnieBean.listCourtier}" itemLabel="#{courtier.abbreviation}" itemValue="#{courtier}" />            
                                                </h:selectOneMenu>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                                <h:outputLabel for="pv"  value="#{msg['titre.pdv']}" class="pull-left text-left"/>                          
                                            </div>  
                                            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                                                <h:selectOneMenu id="pv"  value="#{espaceCompagnieBean.pvSelected}"  converter="entityConverter" class="form-control" >                                          
                                                    <f:selectItem itemLabel="#{msg['titre.pdv']}" itemDisabled="false" />
                                                    <f:selectItems var="pv" value="#{espaceCompagnieBean.listPointsVente}" itemLabel="#{pv.designation}" itemValue="#{pv}" />            
                                                </h:selectOneMenu>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                                <h:outputLabel for="gt"  value="#{msg['titre.guichet']}" class="pull-left text-left"/>
                                            </div>
                                            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                                                <h:selectOneMenu id="gt"  value="#{espaceCompagnieBean.guichetSelected}"  converter="entityConverter" class="form-control" >                                          
                                                    <f:selectItem itemLabel="#{msg['titre.guichet']}" itemDisabled="false" />
                                                    <f:selectItems var="guichet" value="#{espaceCompagnieBean.listGuichet}" itemLabel="#{guichet.designation}" itemValue="#{guichet}" />            
                                                </h:selectOneMenu>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                                <p:outputLabel for="mask" value="#{msg['titre.dateDebut']}" />
                                            </div>
                                            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                                                <p:calendar id="mask"  pattern="dd-MM-yyyy" class="form-control" mask="true" value="#{espaceCompagnieBean.dateDebut}" >
                                                </p:calendar>
                                            </div>
                                        </div>


                                        <div class="form-group">
                                            <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                                <p:outputLabel for="mask" value="#{msg['titre.dateFin']}" />
                                            </div>
                                            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                                                <p:calendar id="mask2"   pattern="dd-MM-yyyy" class="form-control" mask="true" value="#{espaceCompagnieBean.dateFin}">
                                                </p:calendar>
                                            </div>
                                        </div>


                                        <div class="form-group">
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <p:commandButton value="#{msg['btn.rechercher']}" update="message1:facture,@form" class="btn-imprimer btn btn-xs pull-right" onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" action="#{espaceCompagnieBean.trier()}"  />
                                            </div>
                                        </div>


                                    </div>
                                </h:form>
                            </p:panel>
                        </div>
                        <h:form  class="form-horizontal well-sm" id="message1">
                            <p:fieldset style="margin-bottom:20px">                       
                                <div class="panel-heading bg-primary"> 
                                    <p:outputLabel class="police_label" value="#{msg['message.titres']}"></p:outputLabel>
                                </div>
                                <p:dataScroller id="facture" value="#{traitementCompagnieAsVoyageBean.listAssuranceVoyage}" var="facture" chunkSize="10" style="padding:0px;margin: 0px; " class="list-group">
                                    <div class="table-responsive">
                                        <f:facet name="loader">
                                            <p:commandButton type="button" class="btn btn-primary" value="#{msg['titre.plus']}" style="color: white;background:#337ab7; " icon="fa fa-triangle" />
                                        </f:facet>
                                        <p:fieldset style="margin-bottom:5px"> 
                                            <p:commandLink class="col-lg-12 mataille list-group-item lien_liste" onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"  style="text-align:left; margin: 0px;padding:0px " update="detail,text,recherche" >
                                                <p:outputLabel class="col-md-12"  value="#{facture.dateTransaction}" />
                                                <p:outputLabel class="col-md-12"  value="N° #{facture.codeTransaction}" />
                                                <p:graphicImage class="img-circle col-md-3" library="img" name="/mail.png" width="20"/>
                                                <p:outputLabel class="col-md-9" value="#{facture.courtier.abbreviation}"/>
                                                <f:setPropertyActionListener value="#{facture}" target="#{traitementCompagnieAsVoyageBean.assuranceVoyage}" />  
                                            </p:commandLink>
                                        </p:fieldset> 
                                    </div>
                                </p:dataScroller>
                            </p:fieldset>   
                        </h:form>
                        <h:form id="f">
                            <p:remoteCommand name="newProposition"    process="f" partialSubmit="true"  actionListener ="#{traitementCompagnieAsVoyageBean.init()}"  update="message1:facture" autoRun="false"/> 
                        </h:form>
                    </div>

                </div>
                <div class="col-lg-8 col-md-8 col-xs-8 col-sm-8 well-lg" id="espace_detail">
                    <div class="panel">
                        <h:form  class="form-horizontal well-sm" id="detail">
                            <div class="panel-heading bg-primary">  
                                <h:outputLabel class="police_label text-uppercase" value="#{msg['titre.societeDeCourtage']}" ></h:outputLabel>
                            </div>

                            <div class="panel-body"> 

                                <div class="row">

                                    <p:fieldset  legend="#{msg['titre.voirLesReferencesDuClient']}" toggleable="true" collapsed="true" toggleSpeed="500"  style="margin-bottom:20px">                          

                                        <p:panelGrid columns="6" class="table">
                                            <h:outputLabel value="#{msg['client.souscripteur']}"/>
                                            <h:outputText value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.nom}"/>
                                            <h:outputLabel value="#{msg['client.datedenaissance']}"/>
                                            <h:outputText value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.dateNaissance}"/>
                                            <h:outputLabel value="#{msg['client.tel']}"/>
                                            <h:outputText  value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.telephoneMobile}"/>
                                            <h:outputLabel value="#{msg['client.adresse']}"/>
                                            <h:outputText  value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.adresse}"/>
                                        </p:panelGrid>

                                    </p:fieldset>
                                    <p:fieldset  legend="#{msg['titre.voirLesInformationsDuVoyage']}" toggleable="true" collapsed="false"  toggleSpeed="500"  style="margin-bottom:20px">                                              
                                        <p:panelGrid columns="4" class="table">
                                            <p:outputLabel for="typevoyage" value="Type de voyage :"/>
                                            <h:outputText id="typevoyage" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.typeVoyage}"/>
                                            <p:outputLabel for="destination" value="Destination"/>
                                            <h:outputText id="destination" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.paysDestination.nom_en_fr} (#{traitementCompagnieAsVoyageBean.assuranceVoyage.zone})"/>
                                            <p:outputLabel for="datedepart" value="Date depart :"/>
                                            <h:outputText id="datedepart" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.dateDepart}"/>
                                            <p:outputLabel for="dateretour" value="Date retour :"/>
                                            <h:outputText id="dateretour" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.dateRetour}"/>   
                                        </p:panelGrid>
                                    </p:fieldset>
                                    <p:fieldset  legend="Réponses aux Questions" toggleable="true" collapsed="true"  toggleSpeed="500"  style="margin-bottom:20px">                                              
                                        
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-condensed table-striped">
                                                <thead class="text-center bg-gray text-uppercase text-purple text-bold ">
                                                    <tr>
                                                        <td class="">Numéro</td>
                                                        <td class="col-lg-4 col-md-4 col-sm-6 col-xs-12">Questions 1</td>
                                                        <td class="col-lg-2 col-md-2 col-sm-6 col-xs-12">Réponses 1</td> 
                                                        <td class="col-lg-4 col-md-4 col-sm-6 col-xs-12">Questions 2</td>
                                                        <td class="col-lg-2 col-md-2 col-sm-6 col-xs-12">Réponses 2</td> 
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                       <c:forEach items="#{traitementCompagnieAsVoyageBean.assuranceVoyage.listQuestionResponse}" var="q" >
                                                        <tr jsf:id="ll#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.hashCode()}#{q.id()}" jsf:rendered="#{q.question.booleanQuestion}">
                                                            <td class="">
                                                                <h:outputLabel id="n#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.hashCode()}#{q.id()}" >#{q.question.getNumber()}</h:outputLabel>
                                                            </td>
                                                            <td class="">
                                                                <h:outputLabel id="l#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.hashCode()}#{q.id()}" >#{q.question.libelleQuestion}</h:outputLabel>
                                                            </td>
                                                            <td class="text-center">
                                                                <p:outputLabel value="" ><i class="#{q.response} fa fa-check text-green"/><i class="#{!q.response} text-red fa fa-close"/></p:outputLabel>
                                                            </td>
                                                            <td class="">
                                                                <p:outputLabel id="c#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.hashCode()}#{q.id()}" rendered="#{q.renderPrecision()}" value="#{q.questionSecondaire()}" />
                                                            </td>
                                                            <td>
                                                                <p:outputLabel id="d#{traitementCompagnieAsVoyageBean.assuranceVoyage.client.hashCode()}#{q.id()}" rendered="#{q.renderPrecision()}" class="form-control" value="#{q.precisions}" />
                                                            </td>
                                                        </tr>

                                                        <tr jsf:rendered="#{!q.question.booleanQuestion}">
                                                            <td> 
                                                                <h:outputLabel >#{q.question.getNumber()}</h:outputLabel>
                                                            </td>
                                                            <td> 
                                                                <h:outputLabel >#{q.question.libelleQuestion}</h:outputLabel>
                                                            </td> 
                                                            <td class="text-center">
                                                                <p:outputLabel  class="form-control" value="#{q.precisions}" />
                                                            </td> 
                                                            <td></td> 
                                                            <td></td>
                                                        </tr>
                                                    </c:forEach>
                                                </tbody>

                                            </table>
                                        </div> 

                                    </p:fieldset>
                                </div> 

                            </div>

                            <p:confirmDialog  global="true" showEffect="fade" hideEffect="fade">
                                <h:form>
                                    <p:commandButton value="#{msg['supprimer.oui']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"  />
                                    <p:commandButton value="#{msg['supprimer.non']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                                </h:form>
                            </p:confirmDialog>
                        </h:form>
                        <h:form id="text" class="form-horizontal">
                            <p:panel id="calculTotal">
                                <!--p:panelGrid columns="2"  layout="grid"-->
                                <div class="col-md-6 col-lg-6 col-sm-6 col-xs-12" >
                                    <div class="panel panel-border-none" >
                                        <p:outputLabel class="form-control bg-purple" value="#{msg['tableau.primenette']} :" for="ps"></p:outputLabel>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:outputLabel  class="form-control bg-purple" value="#{msg['tableau.accessoire']} :" for="acc"/>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:outputLabel  class="form-control bg-purple" value="#{msg['tableau.reduction']} :" for="red"/>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:outputLabel  class="form-control bg-purple" value="#{msg['tableau.majoration']} :" for="maj"/>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:outputLabel  class="form-control bg-purple" value="#{msg['tableau.remise']} :" for="accrr"/>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:outputLabel class="form-control bg-purple" value="#{msg['tableau.taxe']} :" for="tes"/>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:outputLabel class="form-control bg-purple" value="#{msg['tableau.primettc']} :" for="pttc"/>
                                    </div>

                                </div>
                                <div class="col-md-6 col-lg-6 col-sm-6 col-xs-12" >
                                    <div class="panel panel-border-none" >
                                        
                                        <p:inputText id="ps" class="text-right form-control" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.prixNette}">
                                            <p:ajax event="keyup" update="pttc,tes"  />
                                            <pe:keyFilter  mask="num" />
                                            <f:convertNumber pattern="###,##0" type="number" />
                                        </p:inputText>
                                        
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:inputText id="acc" class="text-right form-control" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.accessoire}">
                                            <p:ajax event="keyup" update="pttc,tes"  />
                                            <pe:keyFilter  mask="num" />
                                            <f:convertNumber pattern="###,##0" type="number" />
                                        </p:inputText>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <div class="row panel-border-none">
                                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                                <p:inputText class="form-control" id="red" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.reduction}">
                                                    <p:ajax event="keyup" update="pttc,redx,tes" />
                                                    <pe:keyFilter  mask="num"  />
                                                    <f:convertNumber pattern="###,##0" type="number" />
                                                </p:inputText>
                                            </div>
                                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                                <h:outputText class="form-control" id="redx"  value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.valeurReduction()}" >
                                                    <f:convertNumber pattern="###,##0" type="number" />
                                                </h:outputText>
                                            </div>
                                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                                <p:selectBooleanCheckbox  itemLabel="En%"  class="pull-right"  id="somm" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.reductionEnPourcentage}" >
                                                    <p:ajax update="tes,redx,pttc" />
                                                </p:selectBooleanCheckbox>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="panel panel-border-none" >
                                        <div class="row">
                                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                                <p:inputText id="maj" class="form-control" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.majoration}">
                                                    <p:ajax event="keyup" update="pttc,redl,tes" />
                                                    <pe:keyFilter  mask="num"  />
                                                    <f:convertNumber pattern="###,##0" type="number" />
                                                </p:inputText>
                                            </div>
                                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                                <h:outputText id="redl" class="form-control" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.valeurMajoration()}" 
                                                              >
                                                    <f:convertNumber pattern="###,##0" type="number" />
                                                </h:outputText>
                                            </div>
                                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                                <p:selectBooleanCheckbox class="pull-right" id="sommm" itemLabel="En%" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.majorationEnPourcentage}" 
                                                                         >
                                                    <p:ajax update="redl,tes,pttc" />
                                                </p:selectBooleanCheckbox>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:inputText id="accrr" class="text-right form-control" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.remise}">
                                            <p:ajax event="keyup" update="pttc,tes"  />
                                            <pe:keyFilter  mask="num" />
                                            <f:convertNumber pattern="###,##0" type="number" />
                                        </p:inputText>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <h:outputText id="tes" class="text-right form-control" value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.valeurTaxes()}">


                                            <f:convertNumber pattern="###,##0" type="number" />
                                        </h:outputText>
                                    </div>
                                    <div class="panel panel-border-none" >
                                        <p:outputLabel id="pttc" class="text-right form-control"  value="#{traitementCompagnieAsVoyageBean.assuranceVoyage.primeTTC}">
                                            <f:convertNumber pattern="###,##0" type="number" />
                                        </p:outputLabel>
                                    </div>
                                </div>
                                <div class="btn-toolbar" >
                                    <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
                                        <p:commandButton rendered="#{(traitementCompagnieAsVoyageBean.assuranceVoyage.idFacture==null)?false:true}" onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" value="Annuler"  action="#{traitementCompagnieAsVoyageBean.annuler()}" class="btn-danger btn"  icon="fa fa-trash" update="@form,message1,detail,vvv" />
                                        <p:commandButton rendered="#{(traitementCompagnieAsVoyageBean.assuranceVoyage.idFacture==null)?false:true}"  onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"  class="btn-success btn pull-right" icon="fa fa-shopping-card" value="Valider" action="#{traitementCompagnieAsVoyageBean.saveOne()}" update="@form,message1,detail,vvv,msgs">  
                                            <p:confirm header="#{msg['btn.confirmation']}" message="#{msg['question.etesVousSur']}" icon="ui-icon-alert"  />
                                        </p:commandButton>
                                    </div>
                                    <p:growl for="somekey" id="vvv"  />
                                    <p:growl id="msgs" globalOnly="true" showDetail="false"  life="3000"/>
                                </div>
                            </p:panel>
                        </h:form>

                        <p:confirmDialog  global="true" showEffect="fade" hideEffect="fade">
                            <h:form>
                                <p:commandButton value="#{msg['supprimer.oui']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"  />
                                <p:commandButton value="#{msg['supprimer.non']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                            </h:form>
                        </p:confirmDialog>
                        <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                            <h:graphicImage library="images" name="ajax-loader.gif" />
                        </p:dialog>
                    </div>
                </div>
            </div>
        </div>

    </ui:composition> 
</html>