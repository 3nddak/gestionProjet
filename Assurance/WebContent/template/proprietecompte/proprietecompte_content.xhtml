<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:sec="http://www.springframework.org/security/tags"
      >
    <ui:composition>
        <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
            <fieldset>
                <legend class=" text-uppercase text-center"><p:outputLabel value="Situation des comptes"></p:outputLabel></legend>
            </fieldset>
            <div id="liste" class="panel">
                <h:form  id="formliste" class="form-horizontal" >
                    <p:panel header="Liste des comptes"  collapsed="false" >

                        <div class="btn-toolbar">
                            <h:commandLink   target="_blank" value="#{msg['btn.imprimer']}" title="#{msg['btn.imprimer']}" class="btn-imprimer btn btn-xs" actionListener="#{comptesBean.doGetA()}"   > 
                                <i class=" glyphicon glyphicon-print"></i>
                            </h:commandLink>  
                        </div>

                        <div class=" table-responsive" >
                            <p:dataTable sortBy="#{compte.idCompte}" sortOrder="descending" paginator="true" rowExpandMode="single" paginatorPosition="bottom" 
                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
                                         emptyMessage="#{msg['tableau.vide']}" class="table table-bordered table-hover"
                                         var="compte" id="comp" rows="25" value="#{comptesBean.allCompte}"
                                         rowsPerPageTemplate="25,50,100,200,500"
                                         reflow="true">
                                <p:ajax event="rowToggle" listener="#{comptesBean.onRowToggle}" update="comp" />

                                <p:column  style="width:70px" headerText="Détail">

                                    <p:rowToggler/>
                                </p:column>

                                <p:column filterBy="#{compte.numCompte}" headerText="Numero">
                                    <h:outputText value="#{compte.numCompte}" />
                                </p:column>
                                <p:column  headerText="Tiers" filterBy="#{compte.compagnie.designation}#{compte.courtier.designation}#{compte.pointsVente.designation}#{compte.societe.designation}"  >
                                    <h:outputText value="#{compte.compagnie.designation}" />
                                    <h:outputText value="#{compte.courtier.designation}" />
                                    <h:outputText value="#{compte.pointsVente.designation}" />
                                    <h:outputText value="#{compte.societe.designation}" />
                                    <h:outputText value="#{compte.guichet.designation}" />
                                    <h:outputText value="#{compte.guichet.pointsVente.designation}" />
                                </p:column>
                                <p:column width="200" filterBy="#{compte.typeCompte.libelle}"  headerText="Type compte">
                                    <h:outputText value="#{compte.typeCompte.libelle}" />
                                </p:column>

                                <p:column filterBy="#{compte.devise.libelle}" headerText="Devise">
                                    <h:outputText value="#{compte.devise.libelle}" />
                                </p:column>
                                <p:column filterBy="#{compte.solde}" headerText="Solde du compte">
                                    <h:outputText value="#{compte.solde}" >
                                        <f:convertNumber   pattern="#,##0.0" type="currency"/>
                                    </h:outputText>
                                </p:column>

                                <p:column rendered="#{sec:areAnyGranted('ADMIN,USER_COMPTABLE')}" headerText="Actions">
                                    <p:commandButton title="#{msg['btn.modifier']}" update="modification" oncomplete="PF('modifier').show()" action="#{comptesBean.modification()}" icon="fa fa-edit" class="btn-primary primary btn-sm">
                                        <f:setPropertyActionListener value="#{compte}" target="#{comptesBean.selectedCompte}" />
                                    </p:commandButton>

                                    <p:commandButton rendered="#{sec:areAllGranted('ADMIN')}" title="#{msg['btn.supprimer']}" oncomplete="PF('supprimer').show()" icon="fa fa-trash" class="btn btn-danger" style="background: #d9534f;color:#fff;border-color: #d43f3a;">
                                        <f:setPropertyActionListener value="#{compte}" target="#{comptesBean.selectedCompte}" />
                                    </p:commandButton>

                                </p:column>

                                <p:rowExpansion >  
                                    <div class="form-group">
                                        <!--<div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Pin"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.pin}"  />
                                            </div>
                                        </div>-->
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Libellé"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.libelleCompte.toLowerCase()}"  />
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Numéro"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.numCompte}"  />
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Débit"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.debit}"/>
                                            </div>
                                        </div>   
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Crédit"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.credit}"  />
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Nature"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.natureCompte}"  />
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Type Compte"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.typeCompte.libelle}"/>
                                            </div>
                                        </div>
                                        <!--
                                         <div class="col-md-4 col-lg-4 col-sm-4">
                                             <div class="input-group">
                                                 <span class="input-group-addon">
                                                     <h:outputText value="Solde minimal"/>
                                                 </span>
                                                 <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.soldeMinimal}"  />
                                             </div>
                                         </div>
                                        -->
                                    </div>
                                    <!-- 
                                     <div class="form-group">
                                         
                                         <div class="col-md-4 col-lg-4 col-sm-4">
                                             <div class="input-group">
                                                 <span class="input-group-addon">
                                                     <h:outputText value="Solde Maximal"/>
                                                 </span>
                                                 <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.soldeMaximal}"/>
                                             </div>
                                         </div>

                                         <div class="col-md-4 col-lg-4 col-sm-4">
                                             <div class="input-group">
                                                 <span class="input-group-addon">
                                                     <h:outputText value="Solde Precedent"/>
                                                 </span>
                                                 <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.soldePrecedent}"  />
                                             </div>
                                         </div>
                                         
                                         
                                     </div>
                                    -->
                                    <div class="form-group">
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Type Tiers"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.typeTiers}"  />
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Tiers"/>
                                                </span>
                                                <h:outputLabel class="form-control" rendered="#{comptesBean.compteSelected.compagnie==null?false:true}" value="#{comptesBean.compteSelected.compagnie.designation}" />
                                                <h:outputLabel class="form-control" rendered="#{comptesBean.compteSelected.courtier==null?false:true}" value="#{comptesBean.compteSelected.courtier.designation}" />
                                                <h:outputLabel class="form-control" rendered="#{comptesBean.compteSelected.pointsVente==null?false:true}" value="#{comptesBean.compteSelected.pointsVente.designation} (#{comptesBean.compteSelected.pointsVente.typePointVente})" />
                                                <h:outputLabel class="form-control" rendered="#{comptesBean.compteSelected.societe==null?false:true}" value="#{comptesBean.compteSelected.societe.designation}" />
                                                <h:outputLabel class="form-control" rendered="#{comptesBean.compteSelected.guichet==null?false:true}" value="#{comptesBean.compteSelected.guichet.designation}" />

                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Date Creation"/>
                                                </span>
                                                <h:outputLabel class="form-control" value="#{comptesBean.compteSelected.dateCreation}">
                                                    <f:convertDateTime  dateStyle="short" />
                                                </h:outputLabel>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="devise"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.devise.libelle}"  />
                                            </div>
                                        </div>
                                        <!--<div class="col-md-4 col-lg-4 col-sm-4">
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <h:outputText value="Numero Compte pere"/>
                                                </span>
                                                <h:outputLabel class="form-control"  value="#{comptesBean.compteSelected.numComptePere}"  />
                                            </div>
                                        </div>
                                        -->
                                    </div>

  <!--p:dataTable var="compteDetail" rowExpandMode="single" id="compteDetail" value="#{comptesBean.compteDetail}" class="table_label table-responsive tableTwo" >

      <p:column width="50" headerText="PIN">
          <h:outputText value="#{compteDetail.pin}" />
      </p:column>
      
      <p:column width="250" headerText="Libellé du Compte">
          <h:outputText value="#{compteDetail.libelleCompte}" />
      </p:column>
      <p:column  headerText="Debit">
          <h:outputText value="#{compteDetail.debit}" />
      </p:column>
      <p:column  headerText="Credit">
          <h:outputText value="#{compteDetail.credit}" />
      </p:column>
      <p:column  headerText="Solde Maximal">
          <h:outputText value="#{compteDetail.soldeMaximal}" />
      </p:column>
      <p:column  headerText="Solde Minimal">
          <h:outputText value="#{compteDetail.soldeMinimal}" />
      </p:column>
      <p:column headerText="Nature">
          <h:outputText value="#{compte.natureCompte}" />
      </p:column>
  </p:dataTable-->

                                </p:rowExpansion>
                            </p:dataTable>
                        </div>
                    </p:panel>
                </h:form>
                <p:dialog  class="police_label" header="Ajout Compte" showEffect="fade" widgetVar="ajouter" modal="true" width="500" minHeight="800" resizable="false">
                    <ui:include src="proprietecompte_ajout.xhtml"/>

                </p:dialog>
                <p:dialog  class="police_label" header="Modifier Compte" showEffect="fade" widgetVar="modifier" modal="true" width="1000" minHeight="200" resizable="false">
                    <ui:include src="proprietecompte_modifier.xhtml"/>

                </p:dialog>


                <h:form>
                    <p:growl id="msgs4" showDetail="false" />

                    <p:confirmDialog class="police_label" id="confirmation" message="#{msg['supprimer.message']}"
                                     header="#{msg['btn.supprimer']}" severity="alert" 
                                     widgetVar="supprimer">

                        <p:commandButton value="#{msg['supprimer.non']}" onclick="PF('supprimer').hide();" type="button" class="btn btn-primary" style="background: #337ab7;color:#fff;border-color: #337ab7;"  />
                        <p:commandButton value="#{msg['supprimer.oui']}" update="msgs4,formliste" action="#{comptesBean.deleteAccount()}"  oncomplete="PF('supprimer').hide()" class="btn btn-danger" style="background: #d9534f;color:#fff;border-color: #d43f3a;" />
                    </p:confirmDialog>
                </h:form>
            </div>
        </div>


    </ui:composition> 
</html>

