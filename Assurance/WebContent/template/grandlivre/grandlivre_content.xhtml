<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition>
        <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
            <fieldset>
                <legend class="text-center text-uppercase"> <p:outputLabel value="GRAND LIVRE"></p:outputLabel></legend>
            </fieldset>
            <div id="liste" class="panel">

                <p:growl id="msgs" showDetail="false"  globalOnly="true" life="3000"  severity="info,warn"/>

                <h:form  id="formliste" class="form-horizontal" >
                    <p:panel header="Infos" toggleable="true" toggleSpeed="500"  collapsed="true">                          
                        <div class="panel-body"> 

                            <div class="form-group">
                                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <h:outputLabel for="mask" value="#{msg['comptabilite.journal.datedebut']}" /><h:outputLabel for="mask" value="*" class="etoile_rouge" />
                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <p:calendar id="mask" class="form-control" required="true" value="#{gLivreBean.du}" pattern="dd-MM-yyyy" mask="true" >
                                        </p:calendar>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <p:outputLabel for="mask2" value="#{msg['comptabilite.journal.datefin']}" /><h:outputLabel for="mask" value="*" class="etoile_rouge" />
                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <p:calendar id="mask2" class="form-control" value="#{gLivreBean.au}" pattern="dd-MM-yyyy" mask="true">
                                        </p:calendar>
                                    </div>
                                </div>
                            </div>
                            <hr/>

                            <div class="form-group">
                                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                    <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
                                        <h:outputLabel for="pays" value="Pays" class=""/>
                                    </div>
                                    <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
                                        <h:selectOneMenu id="pays" value="#{gLivreBean.factureFortri.pays}" converter="omnifaces.SelectItemsConverter" class="form-control"
                                                         >
                                            <f:selectItem itemLabel="#{msg['compagnie.pays']}" itemValue=""/>
                                            <f:selectItems value="#{gLivreBean.listPays}" var="pays" itemLabel="#{pays.designationPays}" itemValue="#{pays}" /> 
                                        </h:selectOneMenu> 
                                    </div>                        
                                </div>

                                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                    <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
                                        <h:outputLabel  for="pss" value="Compagnie " class=""/>
                                    </div>
                                    <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
                                        <h:selectOneMenu   class="form-control" converter="omnifaces.SelectItemsConverter"  id="pss" value="#{gLivreBean.factureFortri.compagnie}"  >
                                            <f:selectItem  itemLabel="Choisir compagnie" itemValue="" /> 
                                            <f:selectItems value="#{gLivreBean.listCompagnie}" var="compagnie"
                                                           itemLabel="#{compagnie.abbreviation}" itemValue="#{compagnie}"/>
                                        </h:selectOneMenu>
                                    </div>
                                </div>  
                                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <h:outputLabel for="courtier"  value="#{msg['titre.courtier']}" class=""/>
                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <h:selectOneMenu   id="courtier"  value="#{gLivreBean.factureFortri.courtier}" converter="omnifaces.SelectItemsConverter"
                                                           class="form-control" >
                                            <f:selectItem itemLabel="#{msg['titre.courtier']}" itemValue=""/>
                                            <f:selectItems itemLabel="#{courtier.designation}" var="courtier"  itemValue="#{courtier}" value="#{gLivreBean.listCourtier}"  />

                                        </h:selectOneMenu>

                                    </div>

                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <h:outputLabel for="pdv"   value="Points de vente" class="pull-left text-left" />
                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <h:selectOneMenu   id="pdv"  value="#{gLivreBean.factureFortri.pointsVente}" converter="omnifaces.SelectItemsConverter"
                                                           class="form-control" >
                                            <f:selectItem itemLabel="Points de vente" itemValue=""/>
                                            <f:selectItems itemLabel="#{pdv.designation}" var="pdv"  itemValue="#{pdv}" value="#{gLivreBean.listPointsVente}"  />

                                        </h:selectOneMenu>
                                    </div>
                                </div>

                                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <h:outputLabel for="gui"   value="Guichets" class="pull-left text-left" />
                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <h:selectOneMenu   id="gui"  value="#{gLivreBean.factureFortri.guichet}" converter="omnifaces.SelectItemsConverter"
                                                           class="form-control" >
                                            <f:selectItem itemLabel="Guichets" itemValue=""/>
                                            <f:selectItems itemLabel="#{gui.designation}" var="gui"  itemValue="#{gui}" value="#{gLivreBean.listGuichets}"  />

                                        </h:selectOneMenu>
                                    </div>
                                </div>


                            </div>



                            <div class="form-group">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <div class="btn-toolbar">
                                            <p:commandButton onstart="PF('statusDialog2').show()" onsuccess="PF('statusDialog2').hide()" value="Rechercher" update="formliste,msgs" actionListener="#{gLivreBean.afficherGrandLivre()}" class="btn btn-imprimer  pull-right" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p:dialog widgetVar="statusDialog2" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                                <h:graphicImage library="images" name="ajax-loader.gif" />
                            </p:dialog>
                        </div>
                    </p:panel>

                    <p:panel header="Grand Livre">
                        <div class="panel-body">
                            <div class="btn-toolbar">
                                <h:commandLink   target="_blank" value="#{msg['btn.imprimer']}" title="#{msg['btn.imprimer']}" class="btn btn-imprimer btn-xs  "  actionListener="#{gLivreBean.doGetAGl()}" > 
                                    <i class=" glyphicon glyphicon-print"></i>
                                </h:commandLink>  
                            </div>
                            <div class="table-responsive">
                                <p:dataTable var="compte" id="t1" value="#{gLivreBean.listComptes}" class="table table-bordered table-striped table-condensed"
                                             paginator="true" rows="#{gLivreBean.nbr}" paginatorPosition="bottom"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             >
                                    <p:ajax event="page" listener="#{gLivreBean.page}" oncomplete="newProposition3()" />

                                    <f:facet name="header">
                                        <h:outputText value="#{gLivreBean.periodeDu}  " />
                                    </f:facet>

                                    <p:columnGroup type="header">
                                        <p:row>

                                            <p:column rowspan="2" headerText="Jour" />
                                            <p:column rowspan="2" headerText="Libelle" />
                                            <p:column rowspan="2" headerText="Reference" />
                                            <p:column colspan="2"  headerText="SOLDE INITIAL" />
                                            <p:column colspan="2" headerText="Mouvement" />
                                            <!--p:column headerText="Mouvement Crédit" /-->
                                            <p:column colspan="2" headerText="Solde progressif" />
                                            <!--p:column headerText="Solde progressif au Crédit" /-->
                                        </p:row>
                                        <p:row>
                                            <p:column headerText="Débit" />
                                            <p:column headerText="Crédit" />
                                            <p:column headerText="Débit" />
                                            <p:column headerText="Crédit" />
                                            <p:column headerText="Débit" />
                                            <p:column headerText="Crédit" />
                                        </p:row>
                                        <p:row id="re" rendered="#{gLivreBean.comptesPre.size() eq 0 ?false:true}" >
                                            <p:column colspan="3" headerText=" Report" />

                                            <p:column >
                                                <f:facet name="header">
                                                    <h:outputText value="#{gLivreBean.reportSoldeInitDebit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="header">
                                                    <h:outputText value="#{gLivreBean.reportSoldeInitCredit }">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>

                                            <p:column  >
                                                <f:facet name="header">
                                                    <h:outputText value="#{gLivreBean.reportDebit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="header">
                                                    <h:outputText value="#{gLivreBean.reportCredit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="header">
                                                    <h:outputText value="#{gLivreBean.soldeReportDebit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="header">
                                                    <h:outputText value="#{gLivreBean.soldeReportCredit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>


                                        </p:row>

                                    </p:columnGroup>

                                    <p:subTable var="journal" value="#{gLivreBean.journalByDate(compte)}">
                                        <f:facet name="header" >
                                            <h:outputText value="#{compte.numCompte}    #{compte.typeTiers}  #{compte.typeCompte.libelle}     #{compte.courtier.abbreviation} #{compte.compagnie.abbreviation} #{compte.pointsVente.designation}" />
                                        </f:facet>

                                        <p:column headerText="Jour">
                                            <h:outputText value="#{journal.transaction.dateTransaction}" />
                                        </p:column>                                               
                                        <p:column>
                                            <h:outputText value="#{journal.description}" />
                                        </p:column>
                                        <p:column headerText="Reference">
                                            <h:outputText value="#{journal.transaction.reference}" />
                                        </p:column >
                                        <p:column >
                                            <h:outputText value="#{journal.debitPrecedent}" >
                                                <f:convertNumber pattern="###,##0" type="number" />
                                            </h:outputText>
                                        </p:column> 
                                        <p:column >
                                            <h:outputText value="#{journal.creditPrecedent}" >
                                                <f:convertNumber pattern="###,##0" type="number" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column >
                                            <h:outputText value="#{journal.debit}" >
                                                <f:convertNumber pattern="###,##0" type="number" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column >
                                            <h:outputText value="#{journal.credit}" >
                                                <f:convertNumber pattern="###,##0" type="number" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column >
                                            <h:outputText value="#{journal.soldedebit}" >
                                                <f:convertNumber pattern="###,##0" type="number" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column >
                                            <h:outputText value="#{journal.soldecredit}" >
                                                <f:convertNumber pattern="###,##0" type="number" />
                                            </h:outputText>
                                        </p:column>

                                        <p:columnGroup type="footer">
                                            <p:row>
                                                <p:column footerText="Total compte  #{compte.numCompte}" colspan="3" style="text-align:right"/>
                                                <p:column >
                                                    <f:facet name="footer">
                                                        <h:outputText value="#{compte.debitPrecedent}" >
                                                            <f:convertNumber pattern="###,##0" type="number" />
                                                        </h:outputText>
                                                    </f:facet>
                                                </p:column> 
                                                <p:column >
                                                    <f:facet name="footer">
                                                        <h:outputText value="#{compte.creditPrecedent}" >
                                                            <f:convertNumber pattern="###,##0" type="number" />
                                                        </h:outputText>
                                                    </f:facet>
                                                </p:column>

                                                <p:column>
                                                    <f:facet name="footer">
                                                        <h:outputText value="#{compte.debit}" >
                                                            <f:convertNumber pattern="###,##0" type="number" />
                                                        </h:outputText>
                                                    </f:facet>
                                                </p:column>
                                                <p:column >
                                                    <f:facet name="footer">
                                                        <h:outputText value="#{compte.credit}" >
                                                            <f:convertNumber pattern="###,##0" type="number" />
                                                        </h:outputText>
                                                    </f:facet>
                                                </p:column>
                                                <p:column>
                                                    <f:facet name="footer">
                                                        <h:outputText value="#{compte.soldedebit}" >
                                                            <f:convertNumber pattern="###,##0" type="number" />
                                                        </h:outputText>
                                                    </f:facet>
                                                </p:column>
                                                <p:column>
                                                    <f:facet name="footer">
                                                        <h:outputText value="#{compte.soldecredit}" >
                                                            <f:convertNumber pattern="###,##0" type="number" />
                                                        </h:outputText>
                                                    </f:facet>
                                                </p:column>
                                            </p:row>

                                        </p:columnGroup>
                                    </p:subTable>
                                    <p:columnGroup type="footer">
                                        <p:row>

                                            <p:column footerText="Totaux " colspan="3" style="text-align:right"/>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.debitSoldePrecTotPage}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>

                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.creditSoldePrecTotPage}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.debitTotPage}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>

                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.creditTotPage}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.soldeDebitTotPage}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>

                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.soldeCreditTotPage}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>

                                        </p:row>
                                        <p:row rendered="#{gLivreBean.listComptes.size() gt gLivreBean.nbr ?true:false}">
                                            <p:column footerText="A reporter " colspan="3" style="text-align:right"/>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{(gLivreBean.reportSoldeInitDebit+ gLivreBean.debitSoldePrecTotPage)}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.reportSoldeInitCredit+ gLivreBean.creditSoldePrecTotPage}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.debitTotPage + gLivreBean.reportDebit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.creditTotPage + gLivreBean.reportCredit }">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>


                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.soldeDebitTotPage + gLivreBean.soldeReportDebit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.soldeCreditTotPage + gLivreBean.soldeReportCredit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>

                                        </p:row>


                                        <p:row  >

                                            <p:column colspan="3" footerText="Totaux Grand Livre" />
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.soldeInitialBalanceDebit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.soldeInitialBalanceCredit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText  value="#{gLivreBean.balanceDebit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.balanceCredit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.soldeBalanceDebit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>
                                            <p:column  >
                                                <f:facet name="footer">
                                                    <h:outputText value="#{gLivreBean.soldeBalanceCredit}">
                                                        <f:convertNumber pattern="###,##0" type="number" />
                                                    </h:outputText>
                                                </f:facet>
                                            </p:column>

                                        </p:row>
                                    </p:columnGroup>

                                </p:dataTable>
                            </div>
                        </div>
                    </p:panel>                               
                    <p:remoteCommand name="newProposition3" partialSubmit="true" update="formliste" autoRun="false"/> 
                </h:form>

            </div>

        </div>
    </ui:composition> 

</html>

